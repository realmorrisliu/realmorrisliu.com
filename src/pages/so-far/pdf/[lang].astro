---
import Layout from "../../../layouts/Layout.astro";
import ResumeLayout from "../../../components/ResumeLayout.astro";
import { getTranslations, getHtmlLangAttribute } from "../../../i18n/utils";
import "../../../styles/global.css";

// Get language from path parameter
const { lang } = Astro.params;
const currentLang = lang === "zh" ? "zh" : "en";
const t = getTranslations(currentLang);
const htmlLang = getHtmlLangAttribute(currentLang);

// Define static paths for generation
export function getStaticPaths() {
  return [{ params: { lang: "zh" } }];
}

// Generate page title and description based on language
const pageTitle = currentLang === "zh" ? "Morris Liu - 简历 (PDF)" : "Morris Liu - Resume (PDF)";

const pageDescription =
  currentLang === "zh"
    ? "Morris Liu 的专业简历PDF版本。全栈工程师 & 技术负责人，7年经验。"
    : "Morris Liu's professional resume in PDF format. Full-Stack Engineer & Technical Leader with 7 years experience.";

const backText = currentLang === "zh" ? "← 返回网页版" : "← Back to web version";
const loadingText =
  currentLang === "zh"
    ? "正在准备PDF... 请在打印对话框中点击「保存为PDF」。"
    : "Preparing PDF... Click 'Save as PDF' in the print dialog.";

const backUrl = currentLang === "zh" ? "/so-far/zh" : "/so-far";
---

<Layout title={pageTitle} description={pageDescription} lang={htmlLang}>
  <!-- PDF Ready indicator -->
  <div class="pdf-loading-indicator">
    <p>{loadingText}</p>
    <a href={backUrl} class="back-link">{backText}</a>
  </div>

  <ResumeLayout currentLang={currentLang} />
</Layout>

<script>
  // Auto-trigger print dialog after page loads
  window.addEventListener("load", () => {
    // Small delay to ensure content is fully rendered
    setTimeout(() => {
      window.print();
    }, 500);
  });
</script>

<style>
  .pdf-loading-indicator {
    text-align: center;
    padding: 20px;
    background: #f5f5f5;
    margin-bottom: 20px;
    font-family: var(--font-sans);
  }

  .pdf-loading-indicator p {
    margin: 0 0 10px 0;
    font-size: 14px;
    color: #666;
  }

  .back-link {
    color: var(--color-text-link);
    text-decoration: underline;
    font-size: 13px;
  }

  .back-link:hover {
    text-decoration: none;
  }

  /* Hide loading indicator in print */
  @media print {
    .pdf-loading-indicator {
      display: none !important;
    }
  }
</style>
